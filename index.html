<!---

    @author Tayyab Javed
    @Org TayyabUniversity.com
    @Date 25/05/2020

    @n="dev"

-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script type='text/javascript' src='knockout-3.5.1.js'></script>

</head>

<!----

    This is for anyone who wants to learn about some advanced
    techniques in web development.

    I pesonally don't use KO but its a good thing to leanr

    This is for my friend wajid so


    1) Notice in the P tags i use data-bind followed by the attribute im binding to for example for P tag its text and for button its click because 
    i am calling a function

    2) The data binds- bind to the viewModel in the javascript

    3) If you have any questions do ask.


-->

<body>

 
    <table>
        <thead>
            <tr>
                <th>Passenger name</th>
                <th>Meal</th>
                <th>Surcharge</th>
                <th></th>
            </tr>
        </thead>


        <tbody data-bind="foreach:seats">
            <tr>
                <td>
                    <input data-bind="value:name" type="text" />
                </td>

                <td><select data-bind="options:$root.availableMeals,value:meal,optionsText:'mealName'"></select></td>
                <!-- <td data-bind="text: meal().mealName"></td> -->
                <td data-bind="text:name"></td>
                <td data-bind="text: meal().price"></td>
                 <td data-bind="click:$root.removeSeat"><button>Remove</button></td>
            </tr>
        </tbody>

        <button data-bind="click:addSeat,enable: seats().length<5">Add Reservation</button>

    </table>

    <h3 data-bind="visible:totalSurcharge()>0">
        Total Surcharge: $<span data-bind="text:totalSurcharge().toFixed(2)"></span>
    </h3>



    <script>
        // This is a simple *viewmodel* - JavaScript that defines the data and behavior of your UI
        //this is the AppViewModel which is basically a way to define an obj you can ignore this for now and learn whats 
        //inside of it
        function AppViewModel() {

            //declare your own observable
            //this.{your own name-observable name}= ko.observable("{put any value here}")
            //now in the html you can make a p tag and use the data-bind="text:{name of observable}"

            //declared 2 observables
            //observables allow you to define values that are observed and updated in realtime
            //so if you bind in the html and the data changes then its updated automatically without
            //managing ui code
            this.firstName = ko.observable("Bert");
            this.lastName = ko.observable("tom")

            //declared a computed value
            //a computed value is basically similiar to observable but its used for making
            //read only data, you do not typically change computed values like observerbales 
            //so if you have 2 observables and want to display data, you can use 2 data-binds or you can
            //create 1 computed to make it nicer and cleaner code
            this.fullName = ko.computed(() => {
                return this.firstName() + " " + this.lastName()
            })

            //declared a function
            //you can bind buttons to functions in the dom
            //here you can declare any function right now
            //this code creates a currentval variable which is assigned to grab the lastName ko.observable value
            //and then sets lastName to be uppercase of its currentVal
            this.capital = function () {
                var currentVal = this.lastName();
                this.lastName(currentVal.toUpperCase());
            }
        }

        //for the reserverations


        function seatReservation(name, initalMeal) {
            var self = this;
            self.name = name;
            self.meal = ko.observable(initalMeal)
        }



        function ReservationsViewModel() {
            var self = this;

            self.availableMeals = [
                { mealName: "Standard (sandwich)", price: 0 },
                { mealName: "Premium (lobster)", price: 34.95 },
                { mealName: "Ultimate (whole zebra)", price: 290 }
            ]


            self.seats = ko.observableArray([
                new seatReservation("Steve", self.availableMeals[0]),
                new seatReservation("Bert", self.availableMeals[0])
            ])

            self.totalSurcharge = ko.computed(function () {
                var total = 0;
                for (var i = 0; i < self.seats().length; i++) {
                    let d = self.seats()[i].meal().price

                    console.log(d);

                    total += d
                }
                return total;
            })


            //add another seat
            self.addSeat = function () {
                self.seats.push(
                    new seatReservation("", self.availableMeals[0])
                )
            }
            //remove 
            self.removeSeat = function (seat) {
                self.seats.remove(seat);
            }

        }

        ko.applyBindings(new ReservationsViewModel());


        // Activates knockout.js and binds dom to the appview model - not important right now
       // ko.applyBindings(new AppViewModel());


    </script>

</body>

</html>